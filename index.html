<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุณุงุจูุฉ ุฑูุถุงู ุงูุฅููุชุฑูููุฉ</title>
    
    <!-- Chosen Palette: Slate (Dark/Backgrounds), Amber (Primary Accent), Green/Red (Status/Actions) -->
    <!-- Application Structure Plan: Single Page Application (SPA) architecture utilizing vanilla JavaScript to toggle visibility of distinct functional views (Home, Register, Week Select, Quiz, Admin). This structure was chosen to provide a fast, app-like experience without page reloads, ensuring smooth transitions and state retention during the quiz process. -->
    <!-- Visualization & Content Choices: Content is organized into modular cards and responsive tables. Data presentation relies on structured HTML grids and flexbox layouts rather than complex external visualization libraries, keeping the application lightweight and focused on the core quiz functionality. Interactive elements include conditional buttons, radio selections, and real-time admin data binding. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Cairo & Tajawal -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', 'Tajawal', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #f8fafc;
            overflow-x: hidden;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .view-section {
            display: none;
            width: 100%;
            justify-content: center;
        }
        .view-section.active {
            display: flex;
        }
        /* Custom Scrollbar for Admin Table */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* News Ticker Animation */
        @keyframes scrollTicker {
            0% { transform: translateX(-100vw); }
            100% { transform: translateX(100vw); }
        }
        .ticker-animate {
            display: inline-block;
            animation: scrollTicker 30s linear infinite;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 relative selection:bg-amber-500/30 pt-16">

    <!-- News Ticker -->
    <div id="news-ticker-container" class="fixed top-0 left-0 w-full bg-slate-900 border-b border-amber-500/30 h-10 flex items-center overflow-hidden z-[100] hidden shadow-md">
        <div class="whitespace-nowrap text-amber-400 font-bold px-4 ticker-animate text-sm md:text-base" id="news-ticker-text"></div>
    </div>

    <!-- Custom Modal for Alerts and Confirmations -->
    <div id="custom-modal" class="fixed inset-0 bg-slate-900/80 z-[100] hidden flex items-center justify-center backdrop-blur-sm px-4">
        <div class="bg-slate-800 border border-slate-700 p-6 rounded-2xl shadow-2xl max-w-sm w-full text-center animate-fade-in">
            <div class="w-16 h-16 bg-amber-500/20 text-amber-500 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl" id="modal-icon">
                ๐
            </div>
            <p id="modal-message" class="text-white text-lg font-semibold mb-6"></p>
            <div class="flex gap-3">
                <button id="modal-btn-cancel" onclick="closeModal()" class="flex-1 py-2 rounded-xl font-bold text-slate-300 bg-slate-700 hover:bg-slate-600 transition">ุฅูุบุงุก</button>
                <button id="modal-btn-confirm" onclick="executeModalAction()" class="flex-1 py-2 rounded-xl font-bold text-slate-900 bg-amber-500 hover:bg-amber-400 transition">ุญุณูุงู</button>
            </div>
        </div>
    </div>

    <!-- Background Ornaments -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-amber-600/10 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-purple-900/20 rounded-full blur-[100px]"></div>
        <div class="absolute top-10 right-10 text-amber-500/20 text-4xl animate-pulse">โจ</div>
        <div class="absolute top-40 left-20 text-amber-500/10 text-6xl animate-pulse" style="animation-delay: 1s;">โจ</div>
        <div class="absolute bottom-20 right-1/4 text-amber-500/20 text-3xl animate-pulse" style="animation-delay: 2s;">โจ</div>
    </div>

    <!-- Main Container -->
    <div class="z-10 w-full flex justify-center">

        <!-- ================= HOME VIEW ================= -->
        <div id="view-home" class="view-section active animate-fade-in">
            <div class="flex flex-col items-center justify-center space-y-6 text-center w-full max-w-3xl">
                <img src="https://storage.googleapis.com/akm1983/%D8%B4%D8%B9%D8%A7%D8%B1-02.png" alt="ุดุนุงุฑ ูุฑูู ุงูุธุงูุฑ ุงูุฑูุงุถู" class="w-32 md:w-48 h-auto object-contain drop-shadow-[0_0_20px_rgba(255,255,255,0.1)] z-10" onerror="this.style.display='none'" />
                <div class="relative">
                    <span class="text-amber-400 text-7xl md:text-8xl drop-shadow-[0_0_15px_rgba(251,191,36,0.5)]">๐</span>
                    <span class="text-amber-200 text-2xl absolute -top-2 -right-2 animate-pulse">โญ</span>
                </div>
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 drop-shadow-lg">ูุณุงุจูุฉ ุฑูุถูุงู ุงูุฅููุชุฑููููุฉ</h1>
                    <p class="text-xl text-amber-100/80 max-w-md mx-auto">ุงุฎุชุจุฑ ูุนูููุงุชู ุงูุฏูููุฉ ูุงุฑุจุญ ุฌูุงุฆุฒ ูููุฉ ูู ุฃุณุจูุน</p>
                    <div class="mt-6 bg-slate-800/80 border border-slate-700 rounded-full px-6 py-3 inline-block shadow-lg">
                        <p class="text-sm md:text-base text-amber-400 font-bold">
                            ุชูุธูู: ุงููุฌูุฉ ุงูุซูุงููุฉ ูุงูุงุฌุชูุงุนูุฉ ุจูุฑูู ุงูุธุงูุฑ ุงูุฑูุงุถู
                        </p>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-4 w-full max-w-md mt-8">
                    <button onclick="switchView('register')" class="flex-1 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-400 hover:to-amber-500 text-slate-900 font-bold py-4 px-6 rounded-2xl shadow-xl transform transition hover:scale-105 flex items-center justify-center gap-2">
                        <span class="text-xl">๐ฅ</span>
                        <span>ุดุงุฑู ุงูุขู</span>
                    </button>
                    <button onclick="switchView('admin-login')" class="flex-1 bg-slate-800 hover:bg-slate-700 border border-slate-700 text-white font-bold py-4 px-6 rounded-2xl shadow-xl transform transition hover:scale-105 flex items-center justify-center gap-2">
                        <span class="text-amber-400 text-xl">๐ก๏ธ</span>
                        <span>ุฏุฎูู ุงูุฅุฏุงุฑุฉ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ================= REGISTER VIEW ================= -->
        <div id="view-register" class="view-section animate-fade-in">
            <div class="w-full max-w-md bg-slate-800/80 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-slate-700">
                <h2 class="text-2xl font-bold text-white mb-6 text-center border-b border-slate-700 pb-4">ุชุณุฌูู ุจูุงูุงุช ุงููุชุณุงุจู</h2>
                <form id="form-register" class="space-y-6">
                    <div>
                        <label class="block text-amber-300 mb-2 text-sm font-semibold">ุงูุงุณู ุงูุซูุงุซู</label>
                        <input type="text" id="input-name" required class="w-full bg-slate-900 border border-slate-700 text-white rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="ุฃุฏุฎู ุงุณูู ุงููุงูู">
                    </div>
                    <div>
                        <label class="block text-amber-300 mb-2 text-sm font-semibold">ุฑูู ุงููุงุชู (ูุน ุงูุฑูุฒ ุงูุฏููู)</label>
                        <input type="tel" id="input-phone" required class="w-full bg-slate-900 border border-slate-700 text-white rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amber-500 text-left" placeholder="ูุซุงู: 96899999999+" dir="ltr">
                        <p class="text-xs text-slate-400 mt-2">ุณูุชู ุงุณุชุฎุฏุงู ูุฐุง ุงูุฑูู ูุฅุจูุงุบู ุจุงูููุฒ ุนุจุฑ ุงููุงุชุณุงุจ</p>
                    </div>
                    <button type="submit" class="w-full bg-amber-500 hover:bg-amber-400 text-slate-900 font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition">
                        <span>ุงููุชุงุจุนุฉ ููุฃุณุฆูุฉ</span>
                        <span>โ๏ธ</span>
                    </button>
                    <button type="button" onclick="switchView('home')" class="w-full text-slate-400 hover:text-white text-sm mt-4 transition">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
                </form>
            </div>
        </div>

        <!-- ================= WEEK SELECTION VIEW ================= -->
        <div id="view-week-selection" class="view-section animate-fade-in">
            <div class="w-full max-w-lg bg-slate-800/80 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-slate-700">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-white mb-2">ุฃููุงู ุจูุ <span id="display-name"></span> ๐</h2>
                    <p class="text-amber-200/80">ุงุฎุชุฑ ุงูุฃุณุจูุน ุงูุญุงูู ููุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4" id="weeks-container">
                    <!-- Weeks will be injected here via JS -->
                </div>
            </div>
        </div>

        <!-- ================= QUIZ VIEW ================= -->
        <div id="view-quiz" class="view-section animate-fade-in">
            <div class="w-full max-w-2xl bg-slate-800/90 backdrop-blur-md p-6 md:p-10 rounded-3xl shadow-2xl border border-slate-700 overflow-y-auto max-h-[85vh]">
                <div class="flex justify-between items-center border-b border-slate-700 pb-4 mb-6">
                    <h2 class="text-2xl font-bold text-white" id="quiz-title">ุฃุณุฆูุฉ ุงูุฃุณุจูุน</h2>
                    <span class="bg-amber-500/20 text-amber-400 px-4 py-1 rounded-full text-sm font-semibold" id="quiz-count"></span>
                </div>
                
                <div id="questions-container" class="space-y-8">
                    <!-- Questions will be injected here via JS -->
                </div>

                <div class="mt-8 flex gap-4">
                    <button onclick="switchView('week-selection')" class="px-6 py-3 rounded-xl font-bold text-slate-300 bg-slate-700 hover:bg-slate-600 transition">ุฑุฌูุน</button>
                    <button id="btn-submit-quiz" onclick="submitQuiz()" disabled class="flex-1 py-3 rounded-xl font-bold text-slate-900 flex items-center justify-center gap-2 transition bg-slate-600 cursor-not-allowed opacity-50">
                        <span id="submit-text">ุงุนุชูุงุฏ ุงูุฅุฌุงุจุงุช</span>
                        <span class="text-lg hidden" id="submit-icon">โ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ================= SUCCESS VIEW ================= -->
        <div id="view-success" class="view-section animate-fade-in">
            <div class="w-full max-w-md bg-slate-800/90 backdrop-blur-md p-10 rounded-3xl shadow-2xl border border-slate-700 text-center">
                <div class="w-24 h-24 bg-green-500/20 text-green-400 rounded-full flex items-center justify-center mx-auto mb-6 text-5xl">
                    โ
                </div>
                <h2 class="text-3xl font-bold text-white mb-4">ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ!</h2>
                <p class="text-slate-300 mb-8 leading-relaxed">
                    ุดูุฑุงู ููุดุงุฑูุชู. ุชู ุญูุธ ุฅุฌุงุจุงุชู ุจูุฌุงุญ.
                    <br/><br/>
                    ุณูุชู ุงูุชูุงุตู ูุน ุงููุงุฆุฒูู ุนุจุฑ ุงููุงุชุณุงุจ. ูุชููู ูู ุงูุชูููู! ๐
                </p>
                <button onclick="resetAndGoHome()" class="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl transition">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
            </div>
        </div>

        <!-- ================= RESULTS VIEW (ุฅุนูุงู ุงููุงุฆุฒูู) ================= -->
        <div id="view-results" class="view-section animate-fade-in">
            <div class="w-full max-w-2xl bg-slate-800/90 backdrop-blur-md p-6 md:p-10 rounded-3xl shadow-2xl border border-slate-700 text-center">
                <h2 class="text-2xl font-bold text-white mb-6" id="results-title">ูุชุงุฆุฌ ุงููุงุฆุฒูู - ุงูุฃุณุจูุน</h2>
                
                <div class="mb-6 rounded-xl overflow-hidden shadow-lg border border-slate-700 bg-black w-full aspect-video relative">
                    <video id="results-video" controls playsinline class="absolute top-0 left-0 w-full h-full object-contain bg-black">
                        ูุชุตูุญู ูุง ูุฏุนู ุชุดุบูู ุงูููุฏูู.
                    </video>
                </div>

                <p class="text-amber-200/80 mb-8 font-semibold">ูุจุงุฑู ูุฌููุน ุงููุงุฆุฒูู ูุญุธุงู ุฃููุฑ ููู ูู ูุญุงูููู ุงูุญุธ ๐น</p>

                <button onclick="switchView('week-selection')" class="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2">
                    <span>ุงูุนูุฏุฉ ููุงุฆูุฉ ุงูุฃุณุงุจูุน</span>
                    <span>๐</span>
                </button>
            </div>
        </div>

        <!-- ================= ADMIN LOGIN VIEW ================= -->
        <div id="view-admin-login" class="view-section animate-fade-in">
            <div class="w-full max-w-sm bg-slate-800/90 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-slate-700 text-center">
                <div class="text-5xl text-amber-500 mb-4">๐ก๏ธ</div>
                <h2 class="text-2xl font-bold text-white mb-6">ุฏุฎูู ุงูุฅุฏุงุฑุฉ</h2>
                <form id="form-admin-login">
                    <input type="password" id="input-admin-pin" placeholder="ุฃุฏุฎู ุฑูุฒ ุงููุฑูุฑ" class="w-full bg-slate-900 border border-slate-700 text-white rounded-xl px-4 py-3 text-center text-xl tracking-widest mb-4 focus:outline-none focus:border-amber-500" dir="ltr">
                    <p id="admin-error" class="text-red-400 text-sm mb-4 hidden">ุฑูุฒ ุงููุฑูุฑ ุบูุฑ ุตุญูุญ</p>
                    <button type="submit" class="w-full bg-amber-500 hover:bg-amber-400 text-slate-900 font-bold py-3 rounded-xl transition">ุชุณุฌูู ุงูุฏุฎูู</button>
                </form>
                <button onclick="switchView('home')" class="mt-4 text-slate-400 text-sm hover:text-white">ุฅูุบุงุก</button>
            </div>
        </div>

        <!-- ================= ADMIN DASHBOARD VIEW ================= -->
        <div id="view-admin-dashboard" class="view-section animate-fade-in">
            <div class="w-full max-w-6xl bg-slate-800/95 backdrop-blur-md rounded-3xl shadow-2xl border border-slate-700 flex flex-col h-[90vh]">
                <!-- Header -->
                <div class="p-6 border-b border-slate-700 flex flex-col sm:flex-row justify-between items-center bg-slate-900/50 rounded-t-3xl gap-4">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl text-amber-400">๐</span>
                        <h2 class="text-2xl font-bold text-white">ููุญุฉ ุชุญูู ุงููุณุงุจูุฉ</h2>
                    </div>
                    <div class="flex items-center gap-2 sm:gap-4 flex-wrap justify-center">
                        <!-- ููุชุฑ ุงูุฃุณุงุจูุน -->
                        <select id="admin-week-filter" onchange="renderAdminTable()" class="bg-slate-800 border border-slate-700 text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-amber-500">
                            <option value="all">ุฌููุน ุงูุฃุณุงุจูุน</option>
                            <option value="1">ุงูุฃุณุจูุน ุงูุฃูู</option>
                            <option value="2" selected>ุงูุฃุณุจูุน ุงูุซุงูู</option>
                            <option value="3">ุงูุฃุณุจูุน ุงูุซุงูุซ</option>
                            <option value="4">ุงูุฃุณุจูุน ุงูุฑุงุจุน</option>
                        </select>
                        
                        <button onclick="exportWinners()" class="bg-green-600/20 text-green-400 hover:bg-green-600 hover:text-white px-3 py-2 rounded-lg text-sm font-semibold transition border border-green-600/30 flex items-center gap-2" title="ุชุตุฏูุฑ ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ (Excel)">
                            <span>๐</span><span class="hidden sm:inline">ุชุตุฏูุฑ ุงููุงุฆุฒูู</span>
                        </button>
                        <button onclick="confirmDeleteAll()" class="bg-red-600/20 text-red-400 hover:bg-red-600 hover:text-white px-3 py-2 rounded-lg text-sm font-semibold transition border border-red-600/30 flex items-center gap-2" title="ุญุฐู ุงููุดุงุฑูุงุช ุงููุนุฑูุถุฉ">
                            <span>๐๏ธ</span><span class="hidden sm:inline">ุญุฐู ุงููุนุฑูุถ</span>
                        </button>
                        <div class="bg-slate-800 px-4 py-2 rounded-lg text-amber-300 font-semibold border border-slate-700">
                            ุงููุดุงุฑูุงุช: <span id="admin-total-count">0</span>
                        </div>
                        <button onclick="logoutAdmin()" class="flex items-center gap-2 text-slate-400 hover:text-red-400 transition" title="ุชุณุฌูู ุงูุฎุฑูุฌ">
                            <span class="text-xl">๐ช</span>
                        </button>
                    </div>
                </div>

                <!-- Ticker Control -->
                <div class="p-4 bg-slate-900/80 border-b border-slate-700 flex flex-col sm:flex-row gap-4 items-center">
                    <span class="text-amber-400 font-bold whitespace-nowrap">๐ข ุงูุดุฑูุท ุงูุฅุฎุจุงุฑู:</span>
                    <input type="text" id="admin-ticker-input" class="flex-1 bg-slate-800 border border-slate-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:border-amber-500" placeholder="ุฃุฏุฎู ุงูุฃุฎุจุงุฑ ุฃู ุงูุฅุนูุงูุงุช ููุง ูุนุฑุถูุง ูููุชุณุงุจููู...">
                    <div class="flex gap-2 w-full sm:w-auto">
                        <button onclick="updateTicker(event)" class="flex-1 sm:flex-none bg-amber-500 hover:bg-amber-400 text-slate-900 px-6 py-2 rounded-lg font-bold transition whitespace-nowrap">ูุดุฑ</button>
                        <button onclick="clearTicker(event)" class="flex-1 sm:flex-none bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg font-bold transition whitespace-nowrap" title="ุฅุฎูุงุก ุงูุดุฑูุท">ุฅุฎูุงุก</button>
                    </div>
                </div>

                <!-- Content -->
                <div class="flex-1 overflow-auto p-6 relative">
                    <div id="admin-loading" class="absolute inset-0 flex flex-col items-center justify-center bg-slate-800/80 z-10 hidden">
                        <span class="text-4xl text-amber-500 mb-4 animate-spin">โณ</span>
                        <p class="text-white">ุฌุงุฑู ุฌูุจ ุงูุจูุงูุงุช...</p>
                    </div>
                    
                    <div id="admin-empty" class="h-full flex flex-col items-center justify-center text-slate-500 hidden">
                        <span class="text-6xl mb-4 opacity-50">๐</span>
                        <p class="text-xl">ูุง ุชูุฌุฏ ูุดุงุฑูุงุช ุญุชู ุงูุขู</p>
                    </div>

                    <div class="overflow-x-auto rounded-xl border border-slate-700" id="admin-table-container">
                        <table class="w-full text-right border-collapse">
                            <thead>
                                <tr class="bg-slate-900 text-slate-300 text-sm">
                                    <th class="p-4 font-semibold">ุงููุชุณุงุจู</th>
                                    <th class="p-4 font-semibold">ุฑูู ุงููุงุชู</th>
                                    <th class="p-4 font-semibold text-center">ุงูุฃุณุจูุน</th>
                                    <th class="p-4 font-semibold text-center">ุงููุชูุฌุฉ</th>
                                    <th class="p-4 font-semibold">ููุช ุงููุดุงุฑูุฉ</th>
                                    <th class="p-4 font-semibold text-center">ุฅุฌุฑุงุก</th>
                                </tr>
                            </thead>
                            <tbody id="admin-table-body">
                                <!-- Data will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Application Logic (Firebase + Vanilla JS) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, doc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration & Initialization ---
        
        // ุชูุนูู ุงูุฃุณุจูุน ุงูุซุงูู ูููู ุงูุฃุณุจูุน ุงูุฃูู
        const CURRENT_ACTIVE_WEEK = 2; 

        // ููุญุฉ ุชุญูู ุณุฑูุนุฉ ูุญุงูุงุช ุงูุฃุณุงุจูุน
        const WEEKS_STATUS = {
            1: 'results',  // ุฅุนูุงู ูุชุงุฆุฌ ุงูุฃุณุจูุน ุงูุฃูู (ููุฏูู)
            2: 'active',   // ุงูุฃุณุจูุน ุงูุซุงูู ููุชูุญ
            3: 'upcoming',
            4: 'upcoming'
        };

        // ุฑูุงุจุท ููุฏูููุงุช ุฅุนูุงู ุงููุชุงุฆุฌ
        const RESULTS_VIDEOS = {
            1: "https://storage.googleapis.com/akm1983/%D8%A7%D8%B9%D9%84%D8%A7%D9%86%20%D8%A7%D9%84%D9%81%D8%A7%D9%8A%D9%94%D8%B2%D9%8A%D9%86%20%D9%81%D9%8A%20%D8%A7%D9%84%D8%A7%D8%B3%D8%A8%D9%88%D8%B9%20%D8%A7%D9%84%D8%A7%D9%88%D9%84.mp4"
        };
        
        const ADMIN_PIN = 'akm1983';

        // ุฅุนุฏุงุฏุงุช Firebase ุงูุฎุงุตุฉ ุจู
        const firebaseConfig = {
            apiKey: "AIzaSyCAsmcMVSGXXGALh5xZmKNDwmv7fQMrmGo",
            authDomain: "pctct-b700f.firebaseapp.com",
            projectId: "pctct-b700f",
            storageBucket: "pctct-b700f.firebasestorage.app",
            messagingSenderId: "551206501024",
            appId: "1:551206501024:web:fa2ac8a45f2aada58267c5",
            measurementId: "G-YYHKWYK8YN"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'pctct-b700f';

        // --- State Variables ---
        let currentUser = null;
        let participant = { name: '', phone: '' };
        let selectedWeek = 2;
        let answers = {};
        let unsubscribeSubmissions = null;
        let isSubmitting = false;
        
        window.currentSubmissions = [];
        let modalCallback = null;

        // --- Quiz Data ---
        const quizData = {
            1: [
                { id: 'q1_1', videoId: '0MofM3htwyE', text: 'ุจูุงุกู ุนูู ุงูููุทุน ุงููุฑุฆูุ ูู ููุนุฏ ููุงู ุงูุฃุจูุงุก ุจุญุธุฑ ุขุจุงุฆูู ูู ุดุจูุงุช ุงูุชูุงุตู ุงูุงุฌุชูุงุนู ูููุนูู ูู ุงููุชุงุจุนุฉ ุจุดูู ูุชูุฑุฑ ูู ุงูุนูููุ', options: ['ูุนูุ ููุนุฏ ูู ุงูุนููู', 'ูุงุ ููุนุฏ ูู ุงูุญุฑูุฉ ุงูุดุฎุตูุฉ', 'ููุฑูู ูููู ููุณ ุนูููุงู'], answer: 'ูุนูุ ููุนุฏ ูู ุงูุนููู' },
                { id: 'q1_2', text: 'ูุง ูู ุงูุชูุณูุฑ ุงูุฐู ุฐูุฑู ุงูุดูุฎ ูุณุจุจ ูุฌูุก ุจุนุถ ุงูุฃุจูุงุก ูุญุธุฑ ุขุจุงุฆูู ูุฃููุงุชููุ', options: ['ูุญูุงูุฉ ุฎุตูุตูุชูู ูู ุฃุตุฏูุงุฆูู', 'ูุฃููู ูุฃุชูู ุจุฃูุนุงู ุชุณุฎุท ูุงูุฏููู ููุณุชุญููู ูู ุงุทูุงุนูู ุนูููุง', 'ุจุณุจุจ ุงุฎุชูุงู ุงูุงูุชูุงูุงุช ุจูู ุงูุฃุฌูุงู'], answer: 'ูุฃููู ูุฃุชูู ุจุฃูุนุงู ุชุณุฎุท ูุงูุฏููู ููุณุชุญููู ูู ุงุทูุงุนูู ุนูููุง' },
                { id: 'q1_3', text: 'ููู ูุตู ุงูุดูุฎ ูุตุฉ ุงูุฌุฏุฉ ุงูุชู ุทูุจุช ูุชุญ ุญุณุงุจุงุช ููุง ูุชุชููู ูู ูุชุงุจุนุฉ ุฃุญูุงุฏูุง ูุฃููู ูุง ูุชูุงุตููู ูุนูุงุ', options: ['ูุตูู ุจุฃูู ุฌูุงุก ููุทูุนุฉ', 'ูุตูู ุจุฃูู ุชุทูุฑ ุทุจูุนู ููุนูุงูุงุช', 'ูุตูู ุจุฃูู ุญุฑุต ูุญููุฏ ูู ุงูุฌุฏุฉ'], answer: 'ูุตูู ุจุฃูู ุฌูุงุก ููุทูุนุฉ' }
            ],
            2: [
                { 
                    id: 'q2_1', 
                    videoId: 'NWI1M3upzEA', // ุชู ุงุณุชุฎุฏุงู ูุนุฑู ุงูููุฏูู ุงููุจุงุดุฑ ูุถูุงู ุงูุนูู
                    text: 'ูุง ููุง ุงููุชุงุจุงู ุงููุฐุงู ูุตุญ ุงูุดูุฎ ุจูุฑุงุกุชููุง ูู ุงูุจููุช ููุนุฑูุฉ ุณูุฑ ุงูุณูู ูุงูููุฉ ูู ุงูุนุจุงุฏุฉุ', 
                    options: ['ุณูุฑ ุงูุดูุงุฎู ูุทุจูุงุช ุงูุฏุฑุฌููู', 'ุฑูุงุถ ุงูุตุงูุญูู ููุชุญ ุงูุจุงุฑู', 'ุฌููุฑ ุงููุธุงู ูุชูููู ุงูุตุจูุงู'], 
                    answer: 'ุณูุฑ ุงูุดูุงุฎู ูุทุจูุงุช ุงูุฏุฑุฌููู' 
                },
                { 
                    id: 'q2_2', 
                    text: 'ูุงุฐุง ุญุฏุซ ุนูุฏูุง ุงูุชููุช ุงูุฌุงุฑูุฉ ุงูุชู ุจุงุนูุง "ุนูู ุจู ุตุงูุญ" ุฅูู ุจูุช ุฃุณูุงุฏูุง ุงูุฌุฏุฏุ', 
                    options: ['ุฃููุธุชูู ูู ุซูุซ ุงูููู ููุตูุงุฉ ูุฃุฎุจุฑููุง ุฃููู ูุตููู ุงููุฑุถ ููุท', 'ุฃุนุฌุจุช ุจููููู ูุฑุงุญุชูู ูุชุฑูุช ููุงู ุงูููู', 'ูุฑุจุช ูู ุจูุชูู ูู ุงูููู ุงูุชุงูู ูุจุงุดุฑุฉ'], 
                    answer: 'ุฃููุธุชูู ูู ุซูุซ ุงูููู ููุตูุงุฉ ูุฃุฎุจุฑููุง ุฃููู ูุตููู ุงููุฑุถ ููุท' 
                },
                { 
                    id: 'q2_3', 
                    text: 'ูุง ูู ุงููุฑุงูุฉ ุงูุชู ุฐูุฑูุง ุงูุดูุฎ ุนู "ุงูุญุณู ุจู ุตุงูุญ ุจู ุญูู" ุนูุฏ ุชุฌููุฒู ููุบุณูุ', 
                    options: ['ูุทู ูุทูุจ ุงูุฅุณุฑุงุน ูู ุชุฌููุฒู ูุฃู ุงููุจู ๏ทบ ููุชุธุฑ ููุตูุงุฉ ุนููู', 'ูุงุญุช ููู ุฑุงุฆุญุฉ ุงููุณู ุงูุชู ููุฃุช ุฃุฑุฌุงุก ุงูููุงู', 'ุงุณุชููุธ ููุฏุน ุฃุฎุงู "ุนูู" ุซู ูุงุช'], 
                    answer: 'ูุทู ูุทูุจ ุงูุฅุณุฑุงุน ูู ุชุฌููุฒู ูุฃู ุงููุจู ๏ทบ ููุชุธุฑ ููุตูุงุฉ ุนููู' 
                },
                { 
                    id: 'q2_4', 
                    text: 'ูู ูุงู ูุฑุฏ ุงูุดูุฎ ุดุงูุณ ุงูุจุทุงุดู (ุฑุญูู ุงููู) ูู ุงููุฑุขู ุงููุฑูู ูู ุงูููู ุงููุงุญุฏุ', 
                    options: ['ุนุดุฑุฉ ุฃุฌุฒุงุก', 'ุฌุฒุก ูุงุญุฏ', 'ุฎูุณุฉ ุฃุฌุฒุงุก'], 
                    answer: 'ุนุดุฑุฉ ุฃุฌุฒุงุก' 
                },
                { 
                    id: 'q2_5', 
                    text: 'ูู ุฑูุนุฉ ูุงู ูุตูู ุงูุดูุฎ ุณุนูุฏ ุจู ุฑุงุดุฏ ููููุงู ููุฑุฏ ูู ุจุญุณุจ ูุง ุฐูุฑ ูู ุงูููุทุนุ', 
                    options: ['120 ุฑูุนุฉ', '80 ุฑูุนุฉ', '40 ุฑูุนุฉ'], 
                    answer: '120 ุฑูุนุฉ' 
                }
            ],
            3: [
                { id: 'q3_1', text: 'ูู ุฃู ุนุงู ูุฌุฑู ููุฑุถ ุตูุงู ุฑูุถุงูุ', options: ['ุงูุนุงู ุงูุฃูู', 'ุงูุนุงู ุงูุซุงูู', 'ุงูุนุงู ุงูุซุงูุซ'], answer: 'ุงูุนุงู ุงูุซุงูู' },
                { id: 'q3_2', text: 'ูู ูู ุงูุตุญุงุจู ุงูุฐู ุฃุดุงุฑ ุจุญูุฑ ุงูุฎูุฏูุ', options: ['ุนูุฑ ุจู ุงูุฎุทุงุจ', 'ุณููุงู ุงููุงุฑุณู', 'ุนูู ุจู ุฃุจู ุทุงูุจ'], answer: 'ุณููุงู ุงููุงุฑุณู' }
            ],
            4: [
                { id: 'q4_1', text: 'ูุชู ูุจุฏุฃ ููุช ุฅุฎุฑุงุฌ ุฒูุงุฉ ุงููุทุฑุ', options: ['ูู ุฃูู ุฑูุถุงู', 'ูู ุงูุนุดุฑ ุงูุฃูุงุฎุฑ', 'ูุจู ุตูุงุฉ ุงูุนูุฏ'], answer: 'ูู ุฃูู ุฑูุถุงู' },
                { id: 'q4_2', text: 'ูุง ูู ุงููููุฉ ุงูุชู ูู ุฎูุฑ ูู ุฃูู ุดูุฑุ', options: ['ูููุฉ ุงูุฅุณุฑุงุก', 'ูููุฉ ุงููุฏุฑ', 'ูููุฉ ุงููุตู ูู ุดุนุจุงู'], answer: 'ูููุฉ ุงููุฏุฑ' }
            ]
        };

        // --- Authentication ---
        async function initAuth() {
            try {
                await signInAnonymously(auth);
            } catch (error) { 
                console.error("Auth Error:", error); 
            }
        }
        initAuth();
        onAuthStateChanged(auth, (user) => { currentUser = user; });

        // --- Global Ticker Listener ---
        const tickerRef = doc(db, 'artifacts', appId, 'public', 'data', 'ramadan_settings', 'global');
        onSnapshot(tickerRef, (docSnap) => {
            const container = document.getElementById('news-ticker-container');
            const textEl = document.getElementById('news-ticker-text');
            const adminInput = document.getElementById('admin-ticker-input');
            
            if (docSnap.exists()) {
                const data = docSnap.data();
                if (data.tickerText && data.tickerText.trim() !== '') {
                    textEl.innerText = data.tickerText;
                    container.classList.remove('hidden');
                    if (adminInput && document.activeElement !== adminInput) {
                        adminInput.value = data.tickerText;
                    }
                } else {
                    container.classList.add('hidden');
                    if (adminInput && document.activeElement !== adminInput) {
                        adminInput.value = '';
                    }
                }
            } else {
                container.classList.add('hidden');
            }
        }, (error) => {
            console.error("Ticker listener error:", error);
        });

        // --- Global UI Functions ---
        window.showModal = (message, callback = null) => {
            document.getElementById('modal-message').innerText = message;
            const cancelBtn = document.getElementById('modal-btn-cancel');
            const confirmBtn = document.getElementById('modal-btn-confirm');
            const icon = document.getElementById('modal-icon');

            if (callback) {
                cancelBtn.classList.remove('hidden');
                confirmBtn.innerText = 'ุชุฃููุฏ';
                icon.innerText = "โ๏ธ";
            } else {
                cancelBtn.classList.add('hidden');
                confirmBtn.innerText = 'ุญุณูุงู';
                icon.innerText = "๐";
            }

            document.getElementById('custom-modal').classList.remove('hidden');
            modalCallback = callback;
        };

        window.closeModal = () => {
            document.getElementById('custom-modal').classList.add('hidden');
            modalCallback = null;
        };

        window.executeModalAction = () => {
            if (modalCallback) modalCallback();
            window.closeModal();
        };

        window.showResults = (week) => {
            const videoUrl = RESULTS_VIDEOS[week];
            if (videoUrl) {
                document.getElementById('results-title').innerText = `ูุชุงุฆุฌ ุงููุงุฆุฒูู - ุงูุฃุณุจูุน ${week}`;
                const videoEl = document.getElementById('results-video');
                // ุชุญุฏูุซ ุงููุตุฏุฑ ูุจุงุดุฑุฉ ุจุฏูู source element
                videoEl.src = videoUrl;
                videoEl.load();
                window.switchView('results');
            } else {
                window.showModal('ูู ูุชู ุฑูุน ููุฏูู ุงููุชุงุฆุฌ ููุฐุง ุงูุฃุณุจูุน ุจุนุฏ.');
            }
        };

        window.updateTicker = async (event) => {
            if (!currentUser) return;
            const text = document.getElementById('admin-ticker-input').value;
            const btn = event.currentTarget;
            const originalText = btn.innerText;
            btn.innerText = 'ุฌุงุฑู...';
            try {
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'ramadan_settings', 'global'), {
                    tickerText: text,
                    updatedAt: serverTimestamp()
                }, { merge: true });
                btn.innerText = 'ุชู ุงููุดุฑ';
            } catch (error) {
                console.error(error);
                window.showModal('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุดุฑ ุงูุดุฑูุท ุงูุฅุฎุจุงุฑู.');
            } finally {
                setTimeout(() => btn.innerText = originalText, 2000);
            }
        };

        window.clearTicker = async (event) => {
            if (!currentUser) return;
            const btn = event.currentTarget;
            const originalText = btn.innerText;
            btn.innerText = 'ุฌุงุฑู...';
            document.getElementById('admin-ticker-input').value = '';
            try {
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'ramadan_settings', 'global'), {
                    tickerText: '',
                    updatedAt: serverTimestamp()
                }, { merge: true });
                btn.innerText = 'ุชู ุงูุฅุฎูุงุก';
            } catch (error) {
                console.error(error);
            } finally {
                setTimeout(() => btn.innerText = originalText, 2000);
            }
        };

        window.switchView = (viewId) => {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${viewId}`).classList.add('active');
            
            // ุฅููุงู ุงูููุฏูู ุชููุงุฆูุงู ุนูุฏ ุงูุฎุฑูุฌ ูู ุดุงุดุฉ ุงููุชุงุฆุฌ
            const resultsVideo = document.getElementById('results-video');
            if (resultsVideo && viewId !== 'results') {
                resultsVideo.pause();
            }

            if (viewId !== 'admin-dashboard' && unsubscribeSubmissions) {
                unsubscribeSubmissions();
                unsubscribeSubmissions = null;
            }

            if (viewId === 'week-selection') renderWeeks();
            if (viewId === 'admin-dashboard') {
                // ูุนูุฏ ุชุนููู ุงูููุชุฑ ููุฃุณุจูุน ุงูุซุงูู ูุงูุชุฑุงุถู ุนูุฏ ุฏุฎูู ุงูุฅุฏุงุฑุฉ ุงูุขู
                const filterEl = document.getElementById('admin-week-filter');
                if(filterEl) filterEl.value = '2'; 
                startAdminListener();
            }
        };

        window.resetAndGoHome = () => {
            participant = { name: '', phone: '' };
            document.getElementById('input-name').value = '';
            document.getElementById('input-phone').value = '';
            window.switchView('home');
        };

        window.logoutAdmin = () => {
            document.getElementById('input-admin-pin').value = '';
            window.switchView('home');
        };

        window.handleSelectWeek = (week) => {
            selectedWeek = week;
            answers = {};
            renderQuiz();
            window.switchView('quiz');
        };

        window.selectOption = (questionId, optionValue) => {
            answers[questionId] = optionValue;
            
            const radios = document.getElementsByName(questionId);
            radios.forEach(radio => {
                const label = radio.closest('label');
                if (radio.value === optionValue) {
                    label.className = "flex items-center p-4 rounded-xl cursor-pointer transition border bg-amber-500/10 border-amber-500 text-amber-300";
                } else {
                    label.className = "flex items-center p-4 rounded-xl cursor-pointer transition border bg-slate-800 border-slate-700 text-slate-300 hover:bg-slate-700";
                }
            });

            const questions = quizData[selectedWeek];
            const allAnswered = questions.every(q => answers[q.id]);
            const submitBtn = document.getElementById('btn-submit-quiz');
            const submitIcon = document.getElementById('submit-icon');
            
            if (allAnswered) {
                submitBtn.disabled = false;
                submitBtn.className = "flex-1 py-3 rounded-xl font-bold text-slate-900 flex items-center justify-center gap-2 transition bg-amber-500 hover:bg-amber-400";
                submitIcon.classList.remove('hidden');
            } else {
                submitBtn.disabled = true;
                submitBtn.className = "flex-1 py-3 rounded-xl font-bold text-slate-900 flex items-center justify-center gap-2 transition bg-slate-600 cursor-not-allowed opacity-50";
                submitIcon.classList.add('hidden');
            }
        };

        window.submitQuiz = async () => {
            if (isSubmitting) return;
            if (!currentUser) {
                window.showModal("ุฌุงุฑู ุงูุงุชุตุงู ุจุงููุธุงู.. ูุฑุฌู ุงูุชุฃูุฏ ูู ุงุชุตุงู ุงูุฅูุชุฑูุช ูุงููุญุงููุฉ ุจุนุฏ ูููู.");
                return;
            }

            isSubmitting = true;
            const btn = document.getElementById('btn-submit-quiz');
            document.getElementById('submit-text').innerText = 'ุฌุงุฑู ุงูุฅุฑุณุงู...';
            
            const weekQuestions = quizData[selectedWeek];
            let score = 0;
            weekQuestions.forEach(q => { if (answers[q.id] === q.answer) score++; });

            try {
                // ุญูุธ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
                const submissionsRef = collection(db, 'artifacts', appId, 'public', 'data', 'ramadan_submissions');
                await addDoc(submissionsRef, {
                    userId: currentUser.uid,
                    name: participant.name,
                    phone: participant.phone,
                    week: selectedWeek,
                    score: score,
                    totalQuestions: weekQuestions.length,
                    answers: answers,
                    timestamp: serverTimestamp()
                });
                window.switchView('success');
            } catch (error) {
                console.error("Submission error:", error);
                window.showModal("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงู. ุชุฃูุฏ ูู ุชูุนูู ููุงุนุฏ ุงูุญูุงูุฉ ูู Firebase ูุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.");
            } finally {
                isSubmitting = false;
                document.getElementById('submit-text').innerText = 'ุงุนุชูุงุฏ ุงูุฅุฌุงุจุงุช';
            }
        };

        // --- Admin Functions ---
        window.sendWhatsApp = (phone, name, week, score, total, type) => {
            let formattedPhone = phone.replace(/\D/g, '');
            if (formattedPhone.startsWith('0')) formattedPhone = formattedPhone.substring(1);
            if (!formattedPhone.startsWith('968') && formattedPhone.length === 8) {
                formattedPhone = '968' + formattedPhone; 
            }
            
            let message = '';
            if (type === 'winner') {
                // ุฑุณุงูุฉ ุงููุงุฆุฒ 
                message = `ูุฑุญุจุงู ${name}! ๐\nูุจุงุฑู ูู ููุฒู ูู ูุณุงุจูุฉ ุฑูุถุงู ุงูุฅููุชุฑูููุฉ (ุงูุฃุณุจูุน ${week}). ๐๐\nููุฏ ุชู ุงุฎุชูุงุฑู ุถูู ุงููุงุฆุฒูู! ูุณุฑูุง ุฅุจูุงุบู ุจุฃูู ุณูุชู ุชุณููู ุงูุฌูุงุฆุฒ ูููุงุฆุฒูู ูู ููุงูุฉ ุดูุฑ ุฑูุถุงู ุงููุจุงุฑู ุฅู ุดุงุก ุงููู. ๐\nุชูุจู ุงููู ุทุงุนุชูู ููู ุนุงู ูุฃูุชู ุจุฎูุฑ. โจ`;
            } else {
                // ุฑุณุงูุฉ ุงูุดูุฑ ูุงููุดุงุฑูุฉ
                message = `ูุฑุญุจุงู ${name}! ๐\nุดูุฑุงู ููุดุงุฑูุชู ูู ูุณุงุจูุฉ ุฑูุถุงู ุงูุฅููุชุฑูููุฉ (ุงูุฃุณุจูุน ${week}).\nูุชูุฌุชู ูู: ${score} ูู ${total}.\nูุชููู ูู ุงูุชูููู ูู ุงูุฃุณุงุจูุน ุงููุงุฏูุฉ! ุชูุจู ุงููู ุทุงุนุชูู ููู ุนุงู ูุฃูุชู ุจุฎูุฑ. โจ`;
            }
            
            const url = `https://api.whatsapp.com/send?phone=${formattedPhone}&text=${encodeURIComponent(message)}`;
            const link = document.createElement('a');
            link.href = url;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // ุฏุงูุฉ ูุฎุตุตุฉ ูุฑุณู ุฌุฏูู ุงูุฅุฏุงุฑุฉ ุจูุงุกู ุนูู ุงูููุชุฑ
        window.renderAdminTable = () => {
            const filterVal = document.getElementById('admin-week-filter') ? document.getElementById('admin-week-filter').value : 'all';
            let dataToRender = window.currentSubmissions;
            
            if (filterVal !== 'all') {
                dataToRender = window.currentSubmissions.filter(sub => String(sub.week) === filterVal);
            }

            document.getElementById('admin-total-count').innerText = dataToRender.length;
            const tableBody = document.getElementById('admin-table-body');
            const emptyState = document.getElementById('admin-empty');
            const tableContainer = document.getElementById('admin-table-container');

            if (dataToRender.length === 0) {
                emptyState.classList.remove('hidden');
                tableContainer.classList.add('hidden');
            } else {
                emptyState.classList.add('hidden');
                tableContainer.classList.remove('hidden');
                tableBody.innerHTML = '';
                
                dataToRender.forEach((sub, idx) => {
                    const dateStr = sub.timestamp ? new Intl.DateTimeFormat('ar-EG', { weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true }).format(sub.timestamp.toDate()) : 'ุงูุขู';
                    const isFullMark = sub.score === sub.totalQuestions;
                    
                    tableBody.innerHTML += `
                        <tr class="border-b border-slate-700/50 hover:bg-slate-700/30 transition ${idx % 2 === 0 ? 'bg-slate-800/30' : ''}">
                            <td class="p-4 font-medium text-white">${sub.name}</td>
                            <td class="p-4 text-amber-200/80" dir="ltr">${sub.phone}</td>
                            <td class="p-4 text-center"><span class="bg-slate-700 text-white px-3 py-1 rounded-full text-xs">ุงูุฃุณุจูุน ${sub.week}</span></td>
                            <td class="p-4 text-center"><span class="px-3 py-1 rounded-full text-xs font-bold ${isFullMark ? 'bg-green-500/20 text-green-400' : 'bg-slate-700 text-slate-300'}">${sub.score} / ${sub.totalQuestions}</span></td>
                            <td class="p-4 text-sm text-slate-400 whitespace-nowrap">${dateStr}</td>
                            <td class="p-4 text-center">
                                <div class="flex items-center justify-center gap-2">
                                    <button onclick="sendWhatsApp('${sub.phone}', '${sub.name}', ${sub.week}, ${sub.score}, ${sub.totalQuestions}, 'winner')" class="bg-amber-500 hover:bg-amber-400 text-slate-900 w-9 h-9 rounded-lg flex items-center justify-center transition shadow-lg shadow-amber-900/20" title="ุชุจุดูุฑ ุจุงูููุฒ">
                                        ๐
                                    </button>
                                    <button onclick="sendWhatsApp('${sub.phone}', '${sub.name}', ${sub.week}, ${sub.score}, ${sub.totalQuestions}, 'thanks')" class="bg-green-600 hover:bg-green-500 text-white w-9 h-9 rounded-lg flex items-center justify-center transition shadow-lg shadow-green-900/20" title="ุฑุณุงูุฉ ุดูุฑ ููุชูุฌุฉ">
                                        ๐ฌ
                                    </button>
                                    <button onclick="confirmDeleteSingle('${sub.id}')" class="bg-red-600/80 hover:bg-red-500 text-white w-9 h-9 rounded-lg flex items-center justify-center transition shadow-lg shadow-red-900/20" title="ุญุฐู ุงููุดุงุฑูุฉ">
                                        ๐๏ธ
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
        };

        window.exportWinners = () => {
            const filterVal = document.getElementById('admin-week-filter') ? document.getElementById('admin-week-filter').value : 'all';
            let dataToExport = window.currentSubmissions;
            if (filterVal !== 'all') {
                dataToExport = window.currentSubmissions.filter(sub => String(sub.week) === filterVal);
            }

            const winners = dataToExport.filter(s => s.score === s.totalQuestions);
            if (winners.length === 0) {
                window.showModal('ูุง ููุฌุฏ ูุงุฆุฒูู ุจุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ ุงููุงููุฉ ูู ุงูุฃุณุจูุน ุงููุนุฑูุถ ูุชุตุฏูุฑูู.');
                return;
            }
            
            let csv = '\uFEFF'; 
            csv += 'ุงูุงุณู,ุฑูู ุงููุงุชู,ุงูุฃุณุจูุน,ุงููุชูุฌุฉ,ุชุงุฑูุฎ ุงููุดุงุฑูุฉ\n';
            
            winners.forEach(w => {
                const dateStr = w.timestamp ? new Date(w.timestamp.toDate()).toLocaleString('ar-EG') : 'ุงูุขู';
                csv += `"${w.name}","${w.phone}","${w.week}","${w.score} ูู ${w.totalQuestions}","${dateStr}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ุงููุงุฆุฒูู_ูุณุงุจูุฉ_ุฑูุถุงู_${filterVal === 'all' ? 'ุงููู' : 'ุงุณุจูุน_'+filterVal}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        window.confirmDeleteAll = () => {
            const filterVal = document.getElementById('admin-week-filter') ? document.getElementById('admin-week-filter').value : 'all';
            let dataToDelete = window.currentSubmissions;
            if (filterVal !== 'all') {
                dataToDelete = window.currentSubmissions.filter(sub => String(sub.week) === filterVal);
            }

            if(dataToDelete.length === 0) return;

            window.showModal(`ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุญุฐู ุฌููุน ุงููุดุงุฑูุงุช ุงููุนุฑูุถุฉ (${dataToDelete.length} ูุดุงุฑูุฉ) ููุงุฆูุงูุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.`, async () => {
                document.getElementById('admin-loading').classList.remove('hidden');
                for(const sub of dataToDelete) {
                    try {
                        await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'ramadan_submissions', sub.id));
                    } catch(e) { console.error(e); }
                }
                document.getElementById('admin-loading').classList.add('hidden');
            });
        };

        window.confirmDeleteSingle = (id) => {
            window.showModal('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุดุงุฑูุฉุ', async () => {
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'ramadan_submissions', id));
                } catch(e) { console.error(e); }
            });
        };

        // --- Event Listeners ---
        document.getElementById('form-register').addEventListener('submit', (e) => {
            e.preventDefault();
            participant.name = document.getElementById('input-name').value.trim();
            participant.phone = document.getElementById('input-phone').value.trim();
            if (participant.name && participant.phone) {
                document.getElementById('display-name').innerText = participant.name;
                window.switchView('week-selection');
            }
        });

        document.getElementById('form-admin-login').addEventListener('submit', (e) => {
            e.preventDefault();
            const pin = document.getElementById('input-admin-pin').value;
            const errorEl = document.getElementById('admin-error');
            if (pin === ADMIN_PIN) {
                errorEl.classList.add('hidden');
                window.switchView('admin-dashboard');
            } else {
                errorEl.classList.remove('hidden');
            }
        });

        // --- Rendering Logic ---
        function renderWeeks() {
            const container = document.getElementById('weeks-container');
            container.innerHTML = '';
            
            [1, 2, 3, 4].forEach(week => {
                const status = WEEKS_STATUS[week] || 'upcoming';
                let btnHTML = '';
                
                if (status === 'sorting') {
                    btnHTML = `
                        <button disabled class="p-6 rounded-2xl flex flex-col items-center justify-center gap-3 transition border bg-amber-900/20 border-amber-700/50 cursor-not-allowed opacity-90">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-amber-900/50 text-amber-400">
                                <span class="text-xl">โณ</span>
                            </div>
                            <span class="font-bold text-amber-200 text-center leading-relaxed">
                                ุงูุฃุณุจูุน ${week}<br/>
                                <span class="text-sm text-amber-300/80 font-semibold">ุฌุงุฑู ุงููุฑุฒ ูููุงุฆุฒูู ุงูุซูุงุซุฉ</span>
                            </span>
                        </button>
                    `;
                } else if (status === 'results') {
                    btnHTML = `
                        <button onclick="showResults(${week})" class="p-6 rounded-2xl flex flex-col items-center justify-center gap-3 transition group border bg-green-900/20 border-green-700/50 hover:bg-green-800/40 shadow-lg shadow-green-900/10">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-green-900/50 text-green-400 group-hover:scale-110 transition">
                                <span class="text-2xl">๐</span>
                            </div>
                            <span class="font-bold text-green-300 text-center leading-relaxed">
                                ุงูุฃุณุจูุน ${week}<br/>
                                <span class="text-sm text-green-200/80 font-semibold">ุดุงูุฏ ุงููุงุฆุฒูู ๐ฌ</span>
                            </span>
                        </button>
                    `;
                } else if (status === 'upcoming') {
                    btnHTML = `
                        <button disabled class="p-6 rounded-2xl flex flex-col items-center justify-center gap-3 transition group border bg-slate-800/50 border-slate-700/50 cursor-not-allowed opacity-60">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-slate-800 text-slate-500">
                                <span class="text-lg">๐</span>
                            </div>
                            <span class="font-semibold text-slate-500">
                                ููุชุญ ูุฑูุจุงู
                            </span>
                        </button>
                    `;
                } else if (status === 'active') {
                    btnHTML = `
                        <button onclick="handleSelectWeek(${week})" class="p-6 rounded-2xl flex flex-col items-center justify-center gap-3 transition group border bg-slate-900 hover:bg-slate-700 border-slate-700 hover:border-amber-500 text-white shadow-lg">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-slate-800 group-hover:bg-amber-500/20 text-amber-400 group-hover:text-amber-300 transition">
                                <span class="text-xl font-bold">${week}</span>
                            </div>
                            <span class="font-semibold">
                                ุฃุณุฆูุฉ ุงูุฃุณุจูุน ${week}
                            </span>
                        </button>
                    `;
                }
                
                container.innerHTML += btnHTML;
            });
        }

        function renderQuiz() {
            const questions = quizData[selectedWeek];
            document.getElementById('quiz-title').innerText = `ุฃุณุฆูุฉ ุงูุฃุณุจูุน ${selectedWeek}`;
            document.getElementById('quiz-count').innerText = `${questions.length} ุฃุณุฆูุฉ`;
            
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                let videoHTML = '';
                if (q.videoId) {
                    // ุชุดุบูู ููุทุน ููุชููุจ ุจุงุณุชุฎุฏุงู ุงูููุฏ ุงููุจุงุดุฑ ูุงูุชุตุฑูุญุงุช ุงูุชู ุฃุฑุณูุชูุง
                    videoHTML = `
                        <div class="mb-6 rounded-xl overflow-hidden shadow-lg border border-slate-700 bg-black relative w-full aspect-video">
                            <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${q.videoId}?rel=0" title="ูุตุฉ ุฑูุงุญ ูุน ุฒูุฌูุง ููุตุต ุฃุฎุฑู ุงูุดูุฎ ูุณุนูุฏ ุงูููุจุงูู" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                        </div>
                    `;
                } else if (q.videoUrl && q.videoUrl.includes('.mp4')) {
                    // ุชุดุบูู ููู MP4 ุงููุจุงุดุฑ ูู ุญุงู ุชู ุงุณุชุฎุฏุงูู ูุงุญูุงู
                    videoHTML = `
                        <div class="mb-6 rounded-xl overflow-hidden shadow-lg border border-slate-700 bg-black relative w-full aspect-video">
                            <video controls playsinline class="absolute top-0 left-0 w-full h-full object-contain bg-black" src="${q.videoUrl}">
                                ูุชุตูุญู ูุง ูุฏุนู ุชุดุบูู ุงูููุฏูู.
                            </video>
                        </div>
                    `;
                }

                let optionsHTML = q.options.map(opt => {
                    const isSelected = answers[q.id] === opt;
                    return `
                        <label class="flex items-center p-4 rounded-xl cursor-pointer transition border ${isSelected ? 'bg-amber-500/10 border-amber-500 text-amber-300' : 'bg-slate-800 border-slate-700 text-slate-300 hover:bg-slate-700'}">
                            <input type="radio" name="${q.id}" value="${opt}" ${isSelected ? 'checked' : ''} onchange="selectOption('${q.id}', '${opt}')" class="w-5 h-5 text-amber-500 bg-slate-900 border-slate-600 focus:ring-amber-500 focus:ring-offset-slate-900">
                            <span class="mr-3 font-medium">${opt}</span>
                        </label>
                    `;
                }).join('');

                container.innerHTML += `
                    <div class="bg-slate-900/50 p-5 rounded-2xl border border-slate-700/50">
                        ${videoHTML}
                        <h3 class="text-lg text-white font-semibold mb-4 leading-relaxed">
                            <span class="text-amber-500 ml-2">${index + 1}.</span> ${q.text}
                        </h3>
                        <div class="space-y-3">
                            ${optionsHTML}
                        </div>
                    </div>
                `;
            });

            const allAnswered = questions.every(q => answers[q.id]);
            const submitBtn = document.getElementById('btn-submit-quiz');
            const submitIcon = document.getElementById('submit-icon');
            
            if (allAnswered) {
                submitBtn.disabled = false;
                submitBtn.className = "flex-1 py-3 rounded-xl font-bold text-slate-900 flex items-center justify-center gap-2 transition bg-amber-500 hover:bg-amber-400";
                submitIcon.classList.remove('hidden');
            } else {
                submitBtn.disabled = true;
                submitBtn.className = "flex-1 py-3 rounded-xl font-bold text-slate-900 flex items-center justify-center gap-2 transition bg-slate-600 cursor-not-allowed opacity-50";
                submitIcon.classList.add('hidden');
            }
        }

        function startAdminListener() {
            if (!currentUser) return;
            document.getElementById('admin-loading').classList.remove('hidden');
            
            const submissionsRef = collection(db, 'artifacts', appId, 'public', 'data', 'ramadan_submissions');
            
            unsubscribeSubmissions = onSnapshot(submissionsRef, (snapshot) => {
                document.getElementById('admin-loading').classList.add('hidden');
                
                let data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                data.sort((a, b) => {
                    const timeA = a.timestamp?.toMillis?.() || 0;
                    const timeB = b.timestamp?.toMillis?.() || 0;
                    return timeB - timeA; 
                });

                window.currentSubmissions = data;
                window.renderAdminTable(); // ุงุณุชุฏุนุงุก ุฏุงูุฉ ุงูุฑุณู ุงูุฌุฏูุฏุฉ ุงูุชู ุชุญุชุฑู ุงูููุชุฑ
                
            }, (error) => {
                console.error("Error fetching submissions:", error);
                document.getElementById('admin-loading').classList.add('hidden');
            });
        }
    </script>
</body>
</html>